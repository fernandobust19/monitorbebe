<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receptor - Monitor Beb√©</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Google MediaPipe y TensorFlow.js optimizado -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì∫ Receptor de Video</h1>
            <p>Monitoreo Autom√°tico con IA</p>
            <button id="backBtn" class="btn-secondary">‚Üê Volver al inicio</button>
        </div>

        <!-- Panel de Alertas Autom√°ticas -->
        <div id="aiAlertsPanel" class="ai-alerts-panel">
            <h4>üö® Alertas del Monitor IA</h4>
            <div id="alertsContainer" class="alerts-container">
                <div class="no-alerts">No hay alertas activas</div>
            </div>
        </div>

        <div class="video-container">
            <div class="video-section full-width">
                <div class="video-header">
                    <h3>Transmisi√≥n en Vivo con IA Autom√°tica</h3>
                    <div class="ai-status-display">
                        <span id="aiAutoStatus" class="ai-auto-status">ü§ñ IA Autom√°tica: Activa</span>
                    </div>
                </div>
                <video id="remoteVideo" 
                       autoplay 
                       playsinline 
                       muted 
                       controls 
                       webkit-playsinline
                       x5-video-player-type="h5"
                       x5-video-orientation="portrait"
                       style="width: 100%; max-height: 70vh; object-fit: contain;"></video>
                <div id="videoOverlay" class="video-overlay" style="display: none;">
                    <div class="play-button-container">
                        <svg class="play-icon" viewBox="0 0 200 200">
                            <polygon points="70, 55 70, 145 145, 100"></polygon>
                        </svg>
                        <span>Toca para Reproducir</span>
                    </div>
                </div>
                <div id="videoStatus" class="video-status">
                    <p>Estado: <span id="streamStatus">Esperando transmisi√≥n...</span></p>
                </div>
            </div>
        </div>

        <div class="connection-panel">
            <div class="room-info">
                <h3>Informaci√≥n de Conexi√≥n</h3>
                <p>ID de Sala: <span id="roomIdDisplay">No conectado</span></p>
                <p>Estado: <span id="connectionStatus">Desconectado</span></p>
                <p>Emisor: <span id="emisorStatus">Esperando...</span></p>
                <p>Receptores: <span id="receptorCount">-</span></p>
            </div>
            
            <div class="reception-controls">
                <button id="requestStreamBtn" class="btn-primary">üì° Solicitar Transmisi√≥n</button>                <button id="playVideoBtn" class="btn-primary" disabled>‚ñ∂Ô∏è Reproducir Video</button>                <button id="fullscreenBtn" class="btn-secondary" disabled>üî≤ Pantalla Completa</button>
                <button id="recordBtn" class="btn-info" disabled>üé• Grabar</button>
                <button id="diagnosticsBtn" class="btn-warning" onclick="runConnectionDiagnostics()">üîß Diagn√≥stico</button>
            </div>
        </div>

        <div class="audio-panel">
            <h3>Control de Audio</h3>
            <div class="audio-controls">
                <button id="muteBtn" class="btn-secondary">üîä Silenciar</button>
                <input type="range" id="volumeSlider" min="0" max="100" value="100" class="volume-slider">
                <span id="volumeDisplay">100%</span>
            </div>
        </div>

        <div class="quality-panel">
            <h3>Informaci√≥n de Calidad</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">Resoluci√≥n:</span>
                    <span id="resolution">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">FPS:</span>
                    <span id="fps">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Bitrate:</span>
                    <span id="bitrate">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Latencia:</span>
                    <span id="latency">-</span>
                </div>
            </div>
        </div>

        <div class="log-panel">
            <h3>Registro de Actividad</h3>
            <div id="logMessages" class="log-messages"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="js/webrtc-check.js"></script>
    <script src="js/alarm-sounds.js"></script>
    <script src="js/ai-baby-monitor-v2.js"></script>
    <script src="js/caregiver-detection.js"></script>
    <script src="js/receptor.js"></script>
</body>
</html>